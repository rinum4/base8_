<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><link rel="stylesheet" type="text/css" href="v8help://service_book/service_style"></link><meta name="GENERATOR" content="MSHTML 11.00.10570.1001"></meta></head><body>
<p>Обработка предназначена для упрощения процесса наполнения информационной базы тестовыми документами в процессе подготовки к нагрузочному тестированию. Для этого обработка выполняет копирование заранее подготовленной совокупности документов из одного периода (эталонного) в другой период (целевой).<br><br>Для обеспечения корректного копирования документов, введенных на основании другого документа, предусмотрена возможность указания реквизита, в котором хранится документ-основание. Для таких документов в процессе копирования будет выполняться автоматическая замена ссылок на исходные документы ссылками на копии соответствующих документов. При необходимости скопированные документы могут быть проведены. Проведение выполняется после полного завершения итерации копирования. Документы проводятся в хронологическом порядке.<br>В обработке имеется возможность автоматического заполнения эталонного и целевого периода. В качестве эталонного по умолчанию используется первый либо последний месяц, в котором введены какие-либо документы. В качестве целевого по умолчанию используется месяц, следующий за последним месяцем, в котором введены какие-либо документы.<br>Также предусмотрена возможность выполнения итерационного копирования до текущего момента, а также возможность копирования всех областей разделенной информационной базы, при условии использования механики разделения данных подсистемы <strong>РаботаВМоделиСервиса</strong> БСП.<br>Каждая итерация копирования периода (включая проведение скопированных документов) выполняется в транзакции, с целью исключения ситуаций, при которых эталонный период копируется не полностью из-за каких-либо ошибок в данных.</p>
<h3>Порядок использования обработки:</h3>
<ol><li>Подготовка документов в эталонном периоде<br><br>Перед использованием обработки требуется выполнить первичное наполнение информационной базы документами. Начальная совокупность документов должна отвечать следующим требованиям: 
<ul><li>Данные в эталонном периоде должны быть введены таким образом, чтобы при полном копировании всех документов в хронологической последовательности в однопользовательском режиме документы проводились без ошибок. Например, не должно возникать ошибок проведения вследствие нехватки остатков. 
</li><li>Рекомендуется (но не обязательно), чтобы начальная совокупность документов находилась в пределах одного месяца<br></li></ul></li><li>Настройка обработчиков<br><br>В обработке реализован ряд обработчиков, которые при необходимости позволяют реализовать особую логику обработки для отдельных документов: <strong>ПередНачаломОбработки</strong>, <strong>ПередКопированием</strong>, <strong>ПослеКопирования</strong>, <strong>ПередПроведением</strong>, <strong>ПослеОкончанияОбработки</strong>. 
<ul><li><strong>ПередНачаломОбработки</strong> - обработчик выполняется до начала процесса копирования, при заполнении настроек обработки.<br>На этом этапе можно уточнить список документов, которые необходимо копировать. Для этого следует уточнить значение параметра обработчика <strong>ВидыДокументовДляОбработки</strong>. Это таблица значений, которая изначально содержит список всех документов, определенных в конфигурации, за исключением документов, включенных в состав подсистемы <strong>ТестЦентр</strong>. В колонке <strong>ВидДокумента</strong> содержится имя документа, как оно задано в конфигурации. В колонке <strong>РеквизитДокументОснование</strong> содержится имя реквизита документа, в котором хранится ссылка на документ-основание (изначально значения в этой колонке не заданы). Если реквизит находится в шапке документа, то имя реквизита указывается непосредственно, например "ДокументОснование". Если реквизит находится в табличной части, то перед именем реквизита необходимо указать имя этой табличной части, например "ДокументыОснования.ДокументОснования".<br><br>Возможны следующие стратегии использования обработчика: 
<ul><li>Уточнение содержимого исходного списка документов (при необходимости):<br><br>// Заполнение реквизита документа-основания для документа "СчетФактураВыданный"<br>СтрСчетФактураВыданный = ВидыДокументовДляОбработки.Найти("СчетФактураВыданный", "ВидДокумента");<br>Если СтрСчетФактураВыданный &lt;&gt; Неопределено Тогда<br>    СтрСчетФактураВыданный.РеквизитДокументОснование = "ДокументыОснования.ДокументОснование";<br>КонецЕсли;<br>...<br>// Удаление документа "ВводНачальныхОстатков" из перечня копируемых документов<br>СтрВводОстатков = ВидыДокументовДляОбработки.Найти("ВводНачальныхОстатков", "ВидДокумента");<br>Если СтрВводОстатков &lt;&gt; Неопределено Тогда<br>    ВидыДокументовДляОбработки.Удалить(СтрВводОстатков);<br>КонецЕсли;<br></li><li>Заполнение списка вручную<br><br>// Очистка списка документов, сформированного автоматически<br>ВидыДокументовДляОбработки.Очистить();<br><br>// Добавление документа "СчетФактураВыданный"<br>НоваяСтрока = ВидыДокументовДляОбработки.Добавить();<br>НоваяСтрока.ВидДокумента              = "СчетФактураВыданный";<br>НоваяСтрока.РеквизитДокументОснование = "ДокументыОснования.ДокументОснование";</li></ul></li><li><strong>ПередКопированием</strong> - обработчик выполняется перед копированием документа.<br>На этом этапе можно отказаться от копирования отдельных документов. Для этого необходимо взвести флаг <strong>Отказ</strong> в значение <strong>Истина</strong>.<br></li><li><strong>ПослеКопирования</strong> - обработчик выполняется после копирования документа, но до его фактической записи.<br>На этом этапе можно при необходимости уточнить значения отдельных реквизитов копии документа, например:<br><br>Если ТипЗнч(СкопированныйДокументОбъект) = Тип("ДокументОбъект.ЗаявлениеНаПредоставлениеСтандартныхВычетовПоНДФЛ") Тогда<br>    СкопированныйДокументОбъект.Месяц = НачалоМесяца(СкопированныйДокументОбъект.Дата);<br>КонецЕсли;<br></li><li><strong>ПередПроведением</strong> - обработчик выполняется перед проведением копии документа.<br>На этом этапе можно отказаться от проведения отдельных документов. Например:<br><br>Если ТипЗнч(СкопированныйДокументОбъект) = Тип("ДокументОбъект.ОперацияБух")<br>    Или ТипЗнч(СкопированныйДокументОбъект) = Тип("ДокументОбъект.РегламентнаяОперация") Тогда<br>    Отказ = Истина;   <br>КонецЕсли;<br></li><li><strong>ПослеОкончанияОбработки</strong> - обработчик выполняется после завершения итерации копирования.<br>Может быть использован для выполнения каких-либо дополнительных действий после итерации копирования, а также на этапе отладки - для отмены транзакции после завершения итерации копирования. Например, для отмены транзакции код обработчика может выглядеть следующим образом:<br><br>// Допустимо использовать только для неитеративного режима (кнопка "Выполнить копирование").<br>// При итеративном копировании (кнопка "Выполнить копирование до текущего момента") будет приводить к зацикливанию.<br>Отказ = Истина;<br>Сообщить("Копирование завершено, транзакция отменена");<br></li></ul></li><li>Тестирование процесса копирования<br>После настройки всех необходимых обработчиков необходимо протестировать корректность работы процесса копирования.<br>Это можно сделать одним из двух способов: 
<ul><li>Выполнить тестовое копирование в копии информационной базы<br>При использовании этого подхода необходимо сохранить подготовленную информационную базу в dt-файл, запустить процесс копирования и убедиться, что документы скопировались и провелись (если включен режим проведения) без ошибок. После окончания отладки базу необходимо восстановить, перенести изменения в код и запустить копирование для подготовки тестовой базы. 
</li><li>Взвести признак <strong>Отказ</strong> обработчике <strong>ПослеОкончанияОбработки</strong><br>При использовании этого подхода необходимо настроить обработчик, запустить процесс копирования с помощью кнопки <strong>Выполнить копирование</strong>, и убедиться в отсутствии ошибок в процессе копирования с помощью журнала регистрации. После окончания отладки убрать отладочный код из обработчика.<br></li></ul></li><li>Неитеративное копирование<br>Неитеративное копирование подразумевает копирование всех документов из эталонного периода в целевой период.<br>Для использования этого режима необходимо: 
<ul><li>Установить даты начала и окончания эталонного и целевого периодов.<br>Даты могут быть заданы вручную либо автоматически. Для автоматического заполнения необходимо выбрать режим заполнения - по первому, либо по последнему месяцу, указать номер области которая будет анализироваться (в случае использования разделенной базы), и нажать кнопку <strong>Заполнить настройки</strong>. 
</li><li>При необходимости можно уточнить список видов документов, которые необходимо скопировать (снять флаги), а также заполнить значения реквизитов-оснований (требуется только в том случае, если обработчик <strong>ПередНачаломОбработки</strong> не был настроен). 
</li><li>Установить значение флага <strong>Проводить скопированные документы</strong>. 
</li><li>Нажать кнопку <strong>Выполнить копирование</strong>.<br></li></ul></li><li>Итеративное копирование<br>Режим итеративного копирования предполагает последовательное копирование данных из одного месяца в следующий месяц, до тех пор, пока не будет достигнут месяц, предшествующий текущему. При этом предполагается, что в целевых периодах отсутствуют какие-либо ранее введенные документы.<br><br>Для использования режима итеративного копирования необходимо: 
<ul><li>В случае использования разделенной базы войти в область данных 
</li><li>Установить даты начала и окончания эталонного и целевого периодов.<br>Даты рекомендуется заполнять автоматически. Для этого необходимо выбрать режим заполнения <strong>По последнему месяцу</strong> и нажать кнопку <strong>Заполнить настройки</strong>. 
</li><li>При необходимости уточнить список видов документов, которые необходимо скопировать (снять флаги), а также заполнить значения реквизитов-оснований (требуется только в том случае, если обработчик <strong>ПередНачаломОбработки</strong> не был настроен). 
</li><li>Установить значение флага <strong>Проводить скопированные документы</strong>. 
</li><li>Нажать кнопку <strong>Выполнить копирование до текущего момента</strong>.</li></ul></li></ol><p> </p></body></html>