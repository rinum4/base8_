
&НаКлиенте
Процедура ВыполнитьСценарий(Команда) Экспорт
	
	Попытка
		ДатаНачала = ТекущаяДата();
		Сценарий = Элементы.Список.ТекущаяСтрока;
		Если Сценарий = Неопределено Тогда
			Возврат;
		КонецЕсли;
		
		Если ТЦСервер.БСППодсистемаИспользуется(ТЦОбщий.БСПИмяПодсистемыУправленияДоступом()) И Не ТЦСервер.БСПРольДоступна("ПолныеПрава") Тогда
			ПоказатьПредупреждение(, "В конфигурации используется подсистема управления доступом БСП.
							|Для корректной работы Тест-центра управляющее подключение должно быть запущено под пользователем с ролью ""ПолныеПрава"".");
			Возврат;
		КонецЕсли;

		Тест = ТЦСервер.ВыполнитьСценарий(Сценарий, Параметры.ПараметрыВыполненияДляВебСервиса);
		Если НЕ ЗначениеЗаполнено(Тест) Тогда
			ПоказатьПредупреждение(, "В данный момент уже выполняется тест," + Символы.ПС + "следует дождаться его окончания.",30,"Ошибка");
			Возврат;
		КонецЕсли;
		
		ТЦКлиент.ПоказатьСостояниеТестирования();
		Элементы.Выполнить.Доступность = Ложь;
	Исключение
		Ошибка = ИнформацияОбОшибке();
		ТЦОбщий.ЗаписатьВЖурнал(Ошибка);
		ТЦКлиент.СообщитьОбОшибке(Ошибка, ДатаНачала, ТекущаяДата());
	КонецПопытки;
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "ТестОкончен" Тогда
		УстановитьДоступностьПриОкончанииТеста();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура УстановитьДоступностьПриОкончанииТеста()
	Элементы.Выполнить.Доступность = Истина;
КонецПроцедуры

&НаКлиенте
Процедура НастроитьЗапуск(Команда)
	
	Сценарий = Элементы.Список.ТекущаяСтрока;
	Если Сценарий = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ПараметрыНастройки = Новый Структура("Сценарий", Сценарий);
	ОткрытьФорму("ОбщаяФорма.ТЦНастройкаЗапускаТеста", ПараметрыНастройки);
	
КонецПроцедуры
